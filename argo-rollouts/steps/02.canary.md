# Canary deployment

We'll first see the canary deployment functionnality of Argo Rollouts. It is the closest match to Kubernetes rolling-update deployment, but adds more checks to allow / deny the upgrade to continue :
- ability to pause between different steps (for a certain duration or wait for manual input)
- direct a certain percentage of traffic to the canary pod
- Analysis as a step / in the background / after a deployment - an Analysis is a set of tests that will be run on the canary replicas.
- Experiment

We'll try deploying a simple Canary deployment first :


```yaml
cat <<EOF | kubectl create -f -
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: example-rollout
spec:
  replicas: 10
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.15.4
        ports:
        - containerPort: 80
  minReadySeconds: 30
  revisionHistoryLimit: 3
  strategy:
    canary: #Indicates that the rollout should use the Canary strategy
      maxSurge: "25%"
      maxUnavailable: 0
      steps:
      - setWeight: 25
      - pause:
          duration: 30s
      - setWeight: 75
      - pause: {} # pause indefinitly - wait for manual input.
EOF
```{{execute HOST1}}

The first version will be deployed directly. If you refresh the argo-rollouts dashboard by clicking on the argo icon, you should see the Rollout appear. From this UI you can manipulate Rollouts, meaning you can allow / cancel an upgrade, force a rollback, etc.

We'll now try modifying the Rollout by changing its base image :

`kubectl patch Rollout example-rollout --type='json' -p='[{"op": "replace", "path": "/spec/template/spec/containers/0/image", "value":"nginx:1.15"}]'`{{execute HOST1}}

You should now see in the UI the rollout following the multiple steps : first deploy 25% of the new pods, then wait for 30s, then deploy 75% of the new pods, and wait indefinitly for a manual input. You can press the "promote" button once you want the deployment to continue. Note that a "full" promotion means skipping all the steps to get to the next version.